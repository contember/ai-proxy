services:
  llm-proxy:
    build: .
    environment:
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - MODEL=${MODEL:-anthropic/claude-haiku-4.5}
      - COMPOSE_PROJECT=llm-proxy
    volumes:
      # Persistent storage for mappings and TLS certificates
      - caddy_data:/data
      - caddy_config:/config
      # Docker socket for container discovery
      - /var/run/docker.sock:/var/run/docker.sock:ro
    # Use host network for:
    # - Full visibility of local processes
    # - Access to Docker container IPs
    # - Binding to port 443
    network_mode: host
    # Use host PID namespace for process discovery
    pid: host
    # Run as root with privileged for full process visibility
    user: root
    privileged: true
    restart: unless-stopped

volumes:
  caddy_data:
  caddy_config:
